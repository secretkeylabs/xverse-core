import { describe, expect, it } from 'vitest';
import {
  inscriptionBurn,
  inscriptionBurnAndSend,
  inscriptionInscribeAndReceive,
  inscriptionInscribeHasMore,
  inscriptionInscribeOne,
  inscriptionSendTwo,
  inscriptionReceiveTwo,
  ownBtcAddresses,
  runeAirDropAddressesHasMore,
  runeBurnAndInscriptionSend,
  runeBurnAndMintBurned,
  runeBurnMinted,
  runeBurnPartial,
  runeConsolidate,
  runeEtchWithInscription,
  runeEtchWithInscriptionAndPremine,
  runeEtchWithPremine,
  runeMintAndSendInscriptionsHasMore,
  runeMintWithExistingRuneBalance,
  runeMintWithoutRuneBalance,
  runeOwnActivityHasMore,
  runePartialSendOne,
  runeReceiveTwo,
  runeSendOneAddessesHasMore,
  runeSendTwo,
  runeSplit,
  getRuneInfoMock,
  multipleAssetsSendTwo,
  multipleAssetsReceiveTwo,
  multipleAssetsBurnTwo,
  runeSendOneConsolidateOne,
  runeBurnOneAndConsolidateTwo,
  multipleAssetsSendTwoConsolidateOne,
  multipleAssetsBurnTwoConsolidateOne,
  receiveBtcWithMultipleExternalAddresses,
  sendBtcToTwoAddresses,
  consolidateBtc,
} from '../../../mocks/btc.indexer.txs';
import BigNumber from 'bignumber.js';
import { enhanceTx, mapRuneToRuneInfo } from '../../../../api/btc';
import { RuneInfo } from '../../../../types';

// MARK: Inscriptions assets
describe('enhanceTx: inscriptions assets', () => {
  [
    {
      name: 'should enhance inscription burn and send',
      tx: inscriptionBurnAndSend,
      expected: {
        id: '8ce5ff910a34d35aa1b3b3ff85d2adff5eafeb604d559926673fbf8dc4a6c70c',
        fees: 8500,
        satsAmount: -938135,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1pe6kte2h685g2x2f3v5up94fhaxsx2s2qxncsx8ll0mmc0sn0es3ssw64hf',
              type: 'tr',
              isInput: false,
              isOutput: true,
            },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 869143,
        blockTime: 1730908708,
        assetInTx: 'inscriptions',
        txType: 'trade',
        inscriptions: {
          hasMore: false,
          items: [
            {
              address: 'bc1q7wgqsjkjf26vmhhkwcfl5famhcytvunphn4phh',
              burned: false,
              contentType: 'text/plain',
              inscribed: false,
              inscriptionId: 'd2bc97646683498ec181993977cab7a117dea955ed9620a6c51be85ea839e060i0',
              received: false,
              sent: true,
            },
            {
              address: 'bc1q7wgqsjkjf26vmhhkwcfl5famhcytvunphn4phh',
              burned: true,
              contentType: 'text/plain',
              inscribed: false,
              inscriptionId: '2b92f9664e562e6f45570f5983b2b09dd41ac38eaef565e047d2a4d5bf397f63i0',
              received: false,
              sent: false,
            },
          ],
        },
      },
    },
    {
      name: 'should enhance inscription burn',
      tx: inscriptionBurn,
      expected: {
        id: '6efb5078c623fa4d06fa3239c1faad302e853040596b41a33374b1800b3daf0d',
        fees: 1181,
        satsAmount: -330,
        addressesInTx: null,
        blockHeight: 860333,
        blockTime: 1725732517,
        assetInTx: 'inscriptions',
        txType: 'burn',
        inscriptions: {
          hasMore: false,
          items: [
            {
              address: 'bc1q7wgqsjkjf26vmhhkwcfl5famhcytvunphn4phh',
              burned: true,
              contentType: 'text/plain;charset=utf-8',
              inscribed: false,
              inscriptionId: 'a1801c8f87a6751826ee902f6143fbf4a212644853428a6f5330b65650aa88a3i0',
              received: false,
              sent: true,
            },
          ],
        },
      },
    },
    {
      name: 'should enhance inscription inscribe has more',
      tx: inscriptionInscribeHasMore,
      expected: {
        id: '54ebc9b442ee70dada61445418d288c7f31ea8d332c5ae9d64bb52d824e00696',
        fees: 157704,
        satsAmount: 330000,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1pvweyc4wfumtl4r86349p6p55kx66k9c0d0gqglkzvfe5zj2x70zscp6fr9',
              type: 'tr',
              isInput: true,
              isOutput: false,
            },
            { address: 'bc1q7f24atnccv7csanq3ujz7x8de740k4vpxfwfj9', type: 'pkh', isInput: false, isOutput: true },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 858563,
        blockTime: 1724707788,
        assetInTx: 'inscriptions',
        txType: 'trade',
        inscriptions: {
          hasMore: true,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain',
              inscribed: true,
              inscriptionId: '54ebc9b442ee70dada61445418d288c7f31ea8d332c5ae9d64bb52d824e00696i0',
              received: true,
              sent: false,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain',
              inscribed: true,
              inscriptionId: '54ebc9b442ee70dada61445418d288c7f31ea8d332c5ae9d64bb52d824e00696i1',
              received: true,
              sent: false,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain',
              inscribed: true,
              inscriptionId: '54ebc9b442ee70dada61445418d288c7f31ea8d332c5ae9d64bb52d824e00696i2',
              received: true,
              sent: false,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain',
              inscribed: true,
              inscriptionId: '54ebc9b442ee70dada61445418d288c7f31ea8d332c5ae9d64bb52d824e00696i3',
              received: true,
              sent: false,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain',
              inscribed: true,
              inscriptionId: '54ebc9b442ee70dada61445418d288c7f31ea8d332c5ae9d64bb52d824e00696i4',
              received: true,
              sent: false,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain',
              inscribed: true,
              inscriptionId: '54ebc9b442ee70dada61445418d288c7f31ea8d332c5ae9d64bb52d824e00696i5',
              received: true,
              sent: false,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain',
              inscribed: true,
              inscriptionId: '54ebc9b442ee70dada61445418d288c7f31ea8d332c5ae9d64bb52d824e00696i6',
              received: true,
              sent: false,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain',
              inscribed: true,
              inscriptionId: '54ebc9b442ee70dada61445418d288c7f31ea8d332c5ae9d64bb52d824e00696i7',
              received: true,
              sent: false,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain',
              inscribed: true,
              inscriptionId: '54ebc9b442ee70dada61445418d288c7f31ea8d332c5ae9d64bb52d824e00696i8',
              received: true,
              sent: false,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain',
              inscribed: true,
              inscriptionId: '54ebc9b442ee70dada61445418d288c7f31ea8d332c5ae9d64bb52d824e00696i9',
              received: true,
              sent: false,
            },
          ],
        },
      },
    },
    {
      name: 'should enhance inscription inscribe and receive',
      tx: inscriptionInscribeAndReceive,
      expected: {
        id: 'ebd6de8f405bd2b1f056eabf11e4bbe98bb406269088e323fa67bc25024515cc',
        fees: 8416,
        satsAmount: 1092,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1pkl8fk9n59ruh3akkfm2pf0j5xxmgptlmvf9gavgkqqerluh2x0esjqmjf6',
              type: 'tr',
              isInput: true,
              isOutput: false,
            },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 838420,
        blockTime: 1712646399,
        assetInTx: 'inscriptions',
        txType: 'trade',
        inscriptions: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'image/png',
              inscribed: false,
              inscriptionId: '9f24c4c5b58ba82fe38e15181b00f0bb090046f85a4c6ebecb0bafeb91c355dfi0',
              received: true,
              sent: false,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'image/png',
              inscribed: true,
              inscriptionId: 'ebd6de8f405bd2b1f056eabf11e4bbe98bb406269088e323fa67bc25024515cci0',
              received: true,
              sent: false,
            },
          ],
        },
      },
    },
    {
      name: 'should enhance inscription inscribe one',
      tx: inscriptionInscribeOne,
      expected: {
        id: '375580abbd09cdb7d5dd1e153d8d6dc9020fd391fa4fe4ffbd4e6b4c450c4785',
        fees: 3864,
        satsAmount: 330,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1ptysvrmq7cjsxfzz9a45j9jtn6ljz6uxp73kmdx4elmfuyrsu5ews5rxq05',
              type: 'tr',
              isInput: true,
              isOutput: false,
            },
            {
              address: 'bc1pvpnmqsyct40xm5ta3r5x59rn7wwskzdpdmzv7lcyz8glxqlfkr4syfgsy4',
              type: 'tr',
              isInput: false,
              isOutput: true,
            },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 869287,
        blockTime: 1730986788,
        assetInTx: 'inscriptions',
        txType: 'inscribe',
        inscriptions: {
          hasMore: false,
          items: [
            {
              address: 'bc1q7wgqsjkjf26vmhhkwcfl5famhcytvunphn4phh',
              burned: false,
              contentType: 'text/plain',
              inscribed: true,
              inscriptionId: '375580abbd09cdb7d5dd1e153d8d6dc9020fd391fa4fe4ffbd4e6b4c450c4785i0',
              received: true,
              sent: false,
            },
          ],
        },
      },
    },
    {
      name: 'should enhance inscription receive two',
      tx: inscriptionReceiveTwo,
      expected: {
        id: '11a6e22bb4325221528b9b35d845c04ff913b928e0c0d40f9b6fd466204ab748',
        fees: 2680,
        satsAmount: 1092,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1ppfwy6c4ldmv2jj9gkyayt0ejmgjcuy955qlnr2682p6fnazr2nkqrkzd7h',
              type: 'tr',
              isInput: true,
              isOutput: false,
            },
            { address: '39JmBRz43rS1zRjQvhqYkPWZmwKqQrgwWZ', type: 'sh', isInput: true, isOutput: true },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 868424,
        blockTime: 1730474734,
        assetInTx: 'inscriptions',
        txType: 'receive',
        inscriptions: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'image/png',
              inscribed: false,
              inscriptionId: '72591a17a1aeb7931a68db524ff755e82210eb50523443fc88cb9baa93daa455i0',
              received: true,
              sent: false,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/html',
              inscribed: false,
              inscriptionId: '922b2a49e348d6e613c7d276b3289a8314002c8c93257c57b327a54aefb61e20i0',
              received: true,
              sent: false,
            },
          ],
        },
      },
    },
    {
      name: 'should enhance inscription send two',
      tx: inscriptionSendTwo,
      expected: {
        id: '11a6e22bb4325221528b9b35d845c04ff913b928e0c0d40f9b6fd466204ab749',
        fees: 2680,
        satsAmount: -3692,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1ppfwy6c4ldmv2jj9gkyayt0ejmgjcuy955qlnr2682p6fnazr2nkqrkzd7h',
              type: 'tr',
              isInput: false,
              isOutput: true,
            },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 868424,
        blockTime: 1730474734,
        assetInTx: 'inscriptions',
        txType: 'send',
        inscriptions: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'image/png',
              inscribed: false,
              inscriptionId: '72591a17a1aeb7931a68db524ff755e82210eb50523443fc88cb9baa93daa455i0',
              received: false,
              sent: true,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/html',
              inscribed: false,
              inscriptionId: '922b2a49e348d6e613c7d276b3289a8314002c8c93257c57b327a54aefb61e20i0',
              received: false,
              sent: true,
            },
          ],
        },
      },
    },
  ].forEach((testCase) => {
    it(testCase.name, () => {
      const result = enhanceTx({ tx: testCase.tx, addresses: ownBtcAddresses, runesInfoDictionary: new Map() });
      expect(result).toEqual(testCase.expected);
    });
  });
});

// MARK:  Runes assets
describe('enhanceTx: runes assets', () => {
  [
    {
      name: 'should enhance rune air drop addresses has more',
      tx: runeAirDropAddressesHasMore,
      runesInfoDictionary: new Map<string, RuneInfo>([['840000:3', mapRuneToRuneInfo(getRuneInfoMock('840000:3'))]]),
      expected: {
        id: 'e79cbd2fb7c1e8e0163ebca1e257bd44d0a5128185c1d90e2f97d2ba67bcd39e',
        fees: 463980,
        satsAmount: 546,
        addressesInTx: {
          hasMore: true,
          external: [],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 840654,
        blockTime: 1713961641,
        assetInTx: 'runes',
        txType: 'receive',
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '800825400000',
              outgoing: '0',
              received: '800825400000',
              runeId: '840000:3',
              sent: '0',
              symbol: '#',
              name: 'RUNE840000:3',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:3',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune send one addresses has more',
      tx: runeSendOneAddessesHasMore,
      runesInfoDictionary: new Map<string, RuneInfo>([['840000:3', mapRuneToRuneInfo(getRuneInfoMock('840000:3'))]]),
      expected: {
        id: 'e79cbd2fb7c1e8e0163ebca1e257bd44d0a5128185c1d90e2f97d2ba67bcd39f',
        fees: 463980,
        satsAmount: -503838,
        addressesInTx: {
          hasMore: true,
          external: [],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 840654,
        blockTime: 1713961641,
        assetInTx: 'runes',
        txType: 'send',
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '0',
              outgoing: '58460254200000',
              received: '0',
              runeId: '840000:3',
              sent: '58460254200000',
              symbol: '#',
              name: 'RUNE840000:3',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:3',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune burn and mint burned',
      tx: runeBurnAndMintBurned,
      runesInfoDictionary: new Map<string, RuneInfo>([
        ['842549:80', mapRuneToRuneInfo(getRuneInfoMock('842549:80'))],
        ['842994:159', mapRuneToRuneInfo(getRuneInfoMock('842994:159'))],
      ]),
      expected: {
        id: '018a0989a5ccaae713ec902794a88186a7a66c33f85ed2abc98e09892d108ce8',
        fees: 132,
        satsAmount: -132,
        addressesInTx: null,
        blockHeight: 843090,
        blockTime: 1715481005,
        assetInTx: 'runes',
        txType: 'burn',
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '0',
              outgoing: '13000000',
              received: '0',
              runeId: '842549:80',
              sent: '13000000',
              symbol: '#',
              name: 'RUNE842549:80',
              divisibility: new BigNumber('4'),
              inscriptionId: 'inscription842549:80',
            },
            {
              runeId: '842994:159',
              address: '',
              sent: '0',
              received: '0',
              outgoing: '0',
              incoming: '0',
              symbol: '#',
              name: 'RUNE842994:159',
              divisibility: new BigNumber('4'),
              inscriptionId: 'inscription842994:159',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune burn minted',
      tx: runeBurnMinted,
      runesInfoDictionary: new Map<string, RuneInfo>([
        ['842994:159', mapRuneToRuneInfo(getRuneInfoMock('842994:159'))],
      ]),
      expected: {
        id: '0013cb4112c6cabc9bf09a29714c36c6ebd678467c3df9e328a261efc419d566',
        fees: 3432,
        satsAmount: -3432,
        addressesInTx: null,
        blockHeight: 843090,
        blockTime: 1715481005,
        assetInTx: 'runes',
        txType: 'mintBurn',
        runes: {
          hasMore: false,
          items: [
            {
              runeId: '842994:159',
              address: '',
              sent: '0',
              received: '0',
              outgoing: '0',
              incoming: '0',
              symbol: '#',
              name: 'RUNE842994:159',
              divisibility: new BigNumber('4'),
              inscriptionId: 'inscription842994:159',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune burn partial',
      tx: runeBurnPartial,
      runesInfoDictionary: new Map<string, RuneInfo>([
        ['840080:127', mapRuneToRuneInfo(getRuneInfoMock('840080:127'))],
      ]),
      expected: {
        id: 'fc7a6d09f020ba6a4835c157232318b0032f9e1fe2e6f62d8b98aab702feeb36',
        fees: 1146,
        satsAmount: 0,
        addressesInTx: null,
        blockHeight: 863340,
        blockTime: 1727603401,
        assetInTx: 'runes',
        txType: 'burn',
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '882500000000',
              outgoing: '888000000000',
              received: '0',
              runeId: '840080:127',
              sent: '5500000000',
              symbol: '#',
              name: 'RUNE840080:127',
              divisibility: new BigNumber('4'),
              inscriptionId: 'inscription840080:127',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune burn inscription send',
      tx: runeBurnAndInscriptionSend,
      runesInfoDictionary: new Map<string, RuneInfo>([
        ['843855:534', mapRuneToRuneInfo(getRuneInfoMock('843855:534'))],
      ]),
      expected: {
        id: '666a69e52a20b86d6fa2b29b724dd0f4020a74b5cddf3a574d0c6638d9828c75',
        fees: 14584,
        satsAmount: -134584,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1qj6t3xvus9f6yukgufgkvtra74u3pp8e48qv9lj',
              type: 'pkh',
              isInput: false,
              isOutput: true,
            },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 843870,
        blockTime: 1715956695,
        assetInTx: 'multipleAssets',
        txType: 'trade',
        inscriptions: {
          hasMore: false,
          items: [
            {
              address: 'bc1q7wgqsjkjf26vmhhkwcfl5famhcytvunphn4phh',
              burned: false,
              contentType: 'text/plain;charset=utf-8',
              inscribed: false,
              inscriptionId: '714ae45a8c5392331430250991f05998f0a412564c95c12c61eecd42936926bai0',
              received: false,
              sent: true,
            },
          ],
        },
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1q7wgqsjkjf26vmhhkwcfl5famhcytvunphn4phh',
              incoming: '0',
              outgoing: '20997060',
              received: '0',
              runeId: '843855:534',
              sent: '20997060',
              symbol: '#',
              name: 'RUNE843855:534',
              divisibility: new BigNumber('4'),
              inscriptionId: 'inscription843855:534',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune consolidate',
      tx: runeConsolidate,
      runesInfoDictionary: new Map<string, RuneInfo>([['1:0', mapRuneToRuneInfo(getRuneInfoMock('1:0'))]]),
      expected: {
        id: '3dc854f7f0bfc5ffe05ae1bdd76166de91609a78e7b2919b6b7a6e944f9b6404',
        fees: 16610,
        satsAmount: -16610,
        addressesInTx: null,
        blockHeight: 862073,
        blockTime: 1726809864,
        assetInTx: 'runes',
        txType: 'consolidate',
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1q7wgqsjkjf26vmhhkwcfl5famhcytvunphn4phh',
              incoming: '9000',
              outgoing: '9000',
              received: '0',
              runeId: '1:0',
              sent: '0',
              symbol: '#',
              name: 'RUNE1:0',
              divisibility: new BigNumber('4'),
              inscriptionId: 'inscription1:0',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune split',
      tx: runeSplit,
      runesInfoDictionary: new Map<string, RuneInfo>([['1:0', mapRuneToRuneInfo(getRuneInfoMock('1:0'))]]),
      expected: {
        id: '6638bff14bf7949c1ddbd4abcdc304b7d9c7b4300f58286f90d1c62a81483d61',
        fees: 13722,
        satsAmount: -22722,
        addressesInTx: null,
        blockHeight: 858508,
        blockTime: 1724667380,
        assetInTx: 'runes',
        txType: 'consolidate',
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '100',
              outgoing: '100',
              received: '0',
              runeId: '1:0',
              sent: '0',
              symbol: '#',
              name: 'RUNE1:0',
              divisibility: new BigNumber('4'),
              inscriptionId: 'inscription1:0',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune etch with inscription',
      tx: runeEtchWithInscription,
      runesInfoDictionary: new Map<string, RuneInfo>([
        ['864877:904', mapRuneToRuneInfo(getRuneInfoMock('864877:904'))],
      ]),
      expected: {
        id: 'd7f65eb2c538f828ce64360bdd5fc1cae8c223158d1406d508e7df7a15d46dcb',
        fees: 5244,
        satsAmount: 546,
        addressesInTx: null,
        blockHeight: 864877,
        blockTime: 1728466580,
        assetInTx: 'multipleAssets',
        txType: 'etch',
        inscriptions: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'image/jpeg',
              inscribed: true,
              inscriptionId: 'd7f65eb2c538f828ce64360bdd5fc1cae8c223158d1406d508e7df7a15d46dcbi0',
              received: true,
              sent: false,
            },
          ],
        },
        runes: {
          hasMore: false,
          items: [
            {
              runeId: '864877:904',
              address: '',
              sent: '0',
              received: '0',
              outgoing: '0',
              incoming: '0',
              symbol: '#',
              name: 'RUNE864877:904',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription864877:904',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune etch with premine',
      tx: runeEtchWithPremine,
      runesInfoDictionary: new Map<string, RuneInfo>([['840000:3', mapRuneToRuneInfo(getRuneInfoMock('840000:3'))]]),
      expected: {
        id: 'e79134080a83fe3e0e06ed6990c5a9b63b362313341745707a2bff7d788a1376',
        fees: 290773010,
        satsAmount: 10000,
        addressesInTx: null,
        blockHeight: 840000,
        blockTime: 1713571767,
        assetInTx: 'runes',
        txType: 'etch',
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '10000000000000000',
              outgoing: '0',
              received: '10000000000000000',
              runeId: '840000:3',
              sent: '0',
              symbol: '#',
              name: 'RUNE840000:3',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:3',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune etch with inscription and premine',
      tx: runeEtchWithInscriptionAndPremine,
      runesInfoDictionary: new Map<string, RuneInfo>([['840000:3', mapRuneToRuneInfo(getRuneInfoMock('840000:3'))]]),
      expected: {
        id: 'e79134080a83fe3e0e06ed6990c5a9b63b362313341745707a2bff7d788a1375',
        fees: 290773010,
        satsAmount: 10330,
        addressesInTx: null,
        blockHeight: 840000,
        blockTime: 1713571767,
        assetInTx: 'multipleAssets',
        txType: 'etch',
        inscriptions: {
          hasMore: false,
          items: [
            {
              address: 'bc1q7wgqsjkjf26vmhhkwcfl5famhcytvunphn4phh',
              burned: false,
              contentType: undefined,
              inscribed: true,
              inscriptionId: 'e79134080a83fe3e0e06ed6990c5a9b63b362313341745707a2bff7d788a1375i0',
              received: true,
              sent: false,
            },
          ],
        },
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '10000000000000000',
              outgoing: '0',
              received: '10000000000000000',
              runeId: '840000:3',
              sent: '0',
              symbol: '#',
              name: 'RUNE840000:3',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:3',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune mint and send inscriptions has more',
      tx: runeMintAndSendInscriptionsHasMore,
      runesInfoDictionary: new Map<string, RuneInfo>([
        ['869349:2029', mapRuneToRuneInfo(getRuneInfoMock('869349:2029'))],
      ]),
      expected: {
        id: '2c307f0a4e36b4af92f62c96398cb9c59f46f91d401ae9bd3c54ad19ea5fa099',
        fees: 520,
        satsAmount: -520,
        addressesInTx: {
          hasMore: false,
          external: [],
          isOwnTaproot: true,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 869361,
        blockTime: 1731028713,
        assetInTx: 'multipleAssets',
        txType: 'trade',
        inscriptions: {
          hasMore: true,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain;charset=utf-8',
              inscribed: false,
              inscriptionId: 'e8e71c0ad24d5676d35d8faa3227348f02bf1605b4703f13a0be65a6e0c5676bi0',
              received: false,
              sent: true,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain;charset=utf-8',
              inscribed: false,
              inscriptionId: '256c1066997f2b8d7240d9c50035b37804fb79237cb1c81c25356878da8ac81bi0',
              received: false,
              sent: true,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain;charset=utf-8',
              inscribed: false,
              inscriptionId: '10d1edbbb64149a327570d62e5ab4e2e1a75a721dd2cc4a3fadd051bb9e1250fi0',
              received: false,
              sent: true,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain;charset=utf-8',
              inscribed: false,
              inscriptionId: 'aac2c19e79b42e06ffb476f9275d44070ba0638cd3d84196831c6221d9b91312i0',
              received: false,
              sent: true,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain;charset=utf-8',
              inscribed: false,
              inscriptionId: '823bdb23114977f416f2ae902f030cc45552ea3c5c29facca185bba2c7aa0fb0i0',
              received: false,
              sent: true,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain;charset=utf-8',
              inscribed: false,
              inscriptionId: '6567af9f947e1d9ea4e12a6c0874252442a9ba56d829fe5f95f776e13bd69ab1i0',
              received: true,
              sent: false,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain;charset=utf-8',
              inscribed: false,
              inscriptionId: '484af92b7ead6da9bfa21de0055714d196ec8d837e12a0dce2654df0d930effbi0',
              received: true,
              sent: false,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain;charset=utf-8',
              inscribed: false,
              inscriptionId: '5396d73f69727a88ea0208a9fdf81226bb392678f253dda711b490201327633di0',
              received: true,
              sent: false,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain;charset=utf-8',
              inscribed: false,
              inscriptionId: 'fd555d39050735755d34d040e174e6df70ec483abab658b45e12f3c4f2257b63i0',
              received: true,
              sent: false,
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain;charset=utf-8',
              inscribed: false,
              inscriptionId: 'ca67020603e12596832fa7632f437057e959e2f1f85161cdf20edf01ee6dba95i0',
              received: true,
              sent: false,
            },
          ],
        },
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '140000',
              outgoing: '120000',
              received: '20000',
              runeId: '869349:2029',
              sent: '0',
              symbol: '#',
              name: 'RUNE869349:2029',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription869349:2029',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune mint with existing rune balance',
      tx: runeMintWithExistingRuneBalance,
      runesInfoDictionary: new Map<string, RuneInfo>([
        ['869099:945', mapRuneToRuneInfo(getRuneInfoMock('869099:945'))],
      ]),
      expected: {
        id: '6a66a1ca2f3940d66f6607248086ec8ad7cca5191068af6b57a6d76bfa0fa115',
        fees: 903,
        satsAmount: -903,
        addressesInTx: null,
        blockHeight: 869103,
        blockTime: 1730890630,
        assetInTx: 'runes',
        txType: 'mint',
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '4500000000',
              outgoing: '4000000000',
              received: '500000000',
              runeId: '869099:945',
              sent: '0',
              symbol: '#',
              name: 'RUNE869099:945',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription869099:945',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune mint without rune balance',
      tx: runeMintWithoutRuneBalance,
      runesInfoDictionary: new Map<string, RuneInfo>([
        ['843261:3229', mapRuneToRuneInfo(getRuneInfoMock('843261:3229'))],
      ]),
      expected: {
        id: 'd80d7ae9b5a136577a6b937c3e8895439e0f7087009f9dcefbcc3c1b49a1b782',
        fees: 1910,
        satsAmount: -8910,
        addressesInTx: null,
        blockHeight: 869959,
        blockTime: 1731399775,
        assetInTx: 'runes',
        txType: 'mint',
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '2100',
              outgoing: '0',
              received: '2100',
              runeId: '843261:3229',
              sent: '0',
              symbol: '#',
              name: 'RUNE843261:3229',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription843261:3229',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune own activity has more',
      tx: runeOwnActivityHasMore,
      runesInfoDictionary: new Map<string, RuneInfo>([
        ['840000:1164', mapRuneToRuneInfo(getRuneInfoMock('840000:1164'))],
        ['840000:1231', mapRuneToRuneInfo(getRuneInfoMock('840000:1231'))],
        ['840000:136', mapRuneToRuneInfo(getRuneInfoMock('840000:136'))],
        ['840000:1611', mapRuneToRuneInfo(getRuneInfoMock('840000:1611'))],
        ['840000:177', mapRuneToRuneInfo(getRuneInfoMock('840000:177'))],
        ['840000:1801', mapRuneToRuneInfo(getRuneInfoMock('840000:1801'))],
        ['840000:2026', mapRuneToRuneInfo(getRuneInfoMock('840000:2026'))],
        ['840000:2125', mapRuneToRuneInfo(getRuneInfoMock('840000:2125'))],
        ['840000:2333', mapRuneToRuneInfo(getRuneInfoMock('840000:2333'))],
        ['840000:245', mapRuneToRuneInfo(getRuneInfoMock('840000:245'))],
      ]),
      expected: {
        id: 'd8633d61d6b56851c5f9ed83424ba8efed514af0255cf4dab60904370670544c',
        fees: 1300,
        satsAmount: 10697778,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1pzrq4kaftwdzu284qmkzyl5yf96nfywschsnkj68d4h7w230fhpdssx2e4l',
              type: 'tr',
              isInput: false,
              isOutput: true,
            },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 854341,
        blockTime: 1722177765,
        assetInTx: 'runes',
        txType: 'trade',
        runes: {
          hasMore: true,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '52500000',
              outgoing: '0',
              received: '52500000',
              runeId: '840000:1164',
              sent: '0',
              symbol: '#',
              name: 'RUNE840000:1164',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:1164',
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '2562000000000000',
              outgoing: '0',
              received: '2562000000000000',
              runeId: '840000:1231',
              sent: '0',
              symbol: '#',
              name: 'RUNE840000:1231',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:1231',
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '22500000',
              outgoing: '0',
              received: '22500000',
              runeId: '840000:136',
              sent: '0',
              symbol: '#',
              name: 'RUNE840000:136',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:136',
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '720000000000000',
              outgoing: '0',
              received: '720000000000000',
              runeId: '840000:1611',
              sent: '0',
              symbol: '#',
              name: 'RUNE840000:1611',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:1611',
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '5760000000000000000',
              outgoing: '0',
              received: '5760000000000000000',
              runeId: '840000:177',
              sent: '0',
              symbol: '#',
              name: 'RUNE840000:177',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:177',
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '72000',
              outgoing: '0',
              received: '72000',
              runeId: '840000:1801',
              sent: '0',
              symbol: '#',
              name: 'RUNE840000:1801',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:1801',
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '100000',
              outgoing: '0',
              received: '100000',
              runeId: '840000:2026',
              sent: '0',
              symbol: '#',
              name: 'RUNE840000:2026',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:2026',
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '25000',
              outgoing: '0',
              received: '25000',
              runeId: '840000:2125',
              sent: '0',
              symbol: '#',
              name: 'RUNE840000:2125',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:2125',
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '42000000000000000',
              outgoing: '0',
              received: '42000000000000000',
              runeId: '840000:2333',
              sent: '0',
              symbol: '#',
              name: 'RUNE840000:2333',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:2333',
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '2500000000',
              outgoing: '0',
              received: '2500000000',
              runeId: '840000:245',
              sent: '0',
              symbol: '#',
              name: 'RUNE840000:245',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:245',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune receive two',
      tx: runeReceiveTwo,
      runesInfoDictionary: new Map<string, RuneInfo>([
        ['840000:2333', mapRuneToRuneInfo(getRuneInfoMock('840000:2333'))],
        ['840000:245', mapRuneToRuneInfo(getRuneInfoMock('840000:245'))],
      ]),
      expected: {
        id: '10d3b216297998b724c69b1d1fa9bf016924bbecd19803ca2c962258a0a77a0b',
        fees: 20924,
        satsAmount: 2184,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1perl3cx6j4d8mpez4er79h90ervefmmy0mct90xl7hzdrkasfuqdsmaksrt',
              type: 'tr',
              isInput: true,
              isOutput: false,
            },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 840806,
        blockTime: 1714041958,
        assetInTx: 'runes',
        txType: 'receive',
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '42000000000000000',
              outgoing: '0',
              received: '42000000000000000',
              runeId: '840000:2333',
              sent: '0',
              symbol: '#',
              name: 'RUNE840000:2333',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:2333',
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '2500000000',
              outgoing: '0',
              received: '2500000000',
              runeId: '840000:245',
              sent: '0',
              symbol: '#',
              name: 'RUNE840000:245',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:245',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune send two',
      tx: runeSendTwo,
      runesInfoDictionary: new Map<string, RuneInfo>([
        ['840000:314', mapRuneToRuneInfo(getRuneInfoMock('840000:314'))],
        ['840000:340', mapRuneToRuneInfo(getRuneInfoMock('840000:340'))],
      ]),
      expected: {
        id: '398fb42bd308473d5ea09c161252fd4add6887688b995bc007512913c245973b',
        fees: 22000,
        satsAmount: -23092,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1p3dnrhlp05lfx5z2mgheqmrktxsqjrhpxwxxeqp437zxwh59fgvus9nmut3',
              type: 'tr',
              isInput: false,
              isOutput: true,
            },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 854341,
        blockTime: 1722177765,
        assetInTx: 'runes',
        txType: 'send',
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '0',
              outgoing: '29170800000000000000000',
              received: '0',
              runeId: '840000:314',
              sent: '29170800000000000000000',
              symbol: '#',
              name: 'RUNE840000:314',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:314',
            },
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '0',
              outgoing: '750000',
              received: '0',
              runeId: '840000:340',
              sent: '750000',
              symbol: '#',
              name: 'RUNE840000:340',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:340',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune partial send one',
      tx: runePartialSendOne,
      runesInfoDictionary: new Map<string, RuneInfo>([['1:0', mapRuneToRuneInfo(getRuneInfoMock('1:0'))]]),
      expected: {
        id: '94fdcfa4fae93644d60b51bd7996c6d3d92eebf87444fe88b1d04758c2acfb6b',
        fees: 888,
        satsAmount: -1434,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1ppfwy6c4ldmv2jj9gkyayt0ejmgjcuy955qlnr2682p6fnazr2nkqrkzd7h',
              type: 'tr',
              isInput: false,
              isOutput: true,
            },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 883191,
        blockTime: 1739204894,
        assetInTx: 'runes',
        txType: 'send',
        runes: {
          hasMore: false,
          items: [
            {
              runeId: '1:0',
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              sent: '3',
              received: '0',
              outgoing: '48',
              incoming: '45',
              symbol: '#',
              name: 'RUNE1:0',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription1:0',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune send one consolidate one',
      tx: runeSendOneConsolidateOne,
      runesInfoDictionary: new Map<string, RuneInfo>([
        ['1:0', mapRuneToRuneInfo(getRuneInfoMock('1:0'))],
        ['840000:3', mapRuneToRuneInfo(getRuneInfoMock('840000:3'))],
      ]),
      expected: {
        id: 'b48dfbc306abd032db4bf732e3194a72c6c8cc1779d21b4cc1e2dd0df4d41793',
        fees: 2984,
        satsAmount: 40,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1pfljyeeyuddpj993expqnsngw2kjt4887we2rf3w00qj7csecxqgsqlae2l',
              type: 'tr',
              isInput: true,
              isOutput: true,
            },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 883418,
        blockTime: 1739359270,
        assetInTx: 'runes',
        txType: 'send',
        runes: {
          hasMore: false,
          items: [
            {
              runeId: '840000:3',
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              sent: '100000000',
              received: '0',
              outgoing: '385789160',
              incoming: '285789160',
              symbol: '#',
              name: 'RUNE840000:3',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:3',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance rune burn one consolidate two',
      tx: runeBurnOneAndConsolidateTwo,
      runesInfoDictionary: new Map<string, RuneInfo>([
        ['840000:183', mapRuneToRuneInfo(getRuneInfoMock('840000:183'))],
        ['840000:2', mapRuneToRuneInfo(getRuneInfoMock('840000:2'))],
        ['840000:3', mapRuneToRuneInfo(getRuneInfoMock('840000:3'))],
      ]),
      expected: {
        id: '7eb47951b6ce807be294dff1f663b6018cfc976f1818e164c574f0c020dfe339',
        fees: 8010,
        satsAmount: -2214,
        addressesInTx: null,
        blockHeight: 883310,
        blockTime: 1739280871,
        assetInTx: 'runes',
        txType: 'burn',
        runes: {
          hasMore: false,
          items: [
            {
              runeId: '840000:3',
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              sent: '486097716',
              received: '0',
              outgoing: '486097716',
              incoming: '0',
              symbol: '#',
              name: 'RUNE840000:3',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:3',
            },
          ],
        },
      },
    },
  ].forEach((testCase) => {
    it(testCase.name, () => {
      const result = enhanceTx({
        tx: testCase.tx,
        addresses: ownBtcAddresses,
        runesInfoDictionary: testCase.runesInfoDictionary,
      });
      expect(result).toEqual(testCase.expected);
    });
  });
});

// MARK: Multiple assets
describe('enhanceTx: multiple assets', () => {
  [
    {
      name: 'should enhance multiple assets send two',
      tx: multipleAssetsSendTwo,
      runesInfoDictionary: new Map<string, RuneInfo>([['1:0', mapRuneToRuneInfo(getRuneInfoMock('1:0'))]]),
      expected: {
        id: '94fdcfa4fae93644d60b51bd7996c6d3d92eebf87444fe88b1d04758c2acfb6b',
        fees: 888,
        satsAmount: -29697,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1ppfwy6c4ldmv2jj9gkyayt0ejmgjcuy955qlnr2682p6fnazr2nkqrkzd7h',
              type: 'tr',
              isInput: false,
              isOutput: true,
            },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 883191,
        blockTime: 1739204894,
        assetInTx: 'multipleAssets',
        txType: 'send',
        inscriptions: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/html',
              inscribed: false,
              inscriptionId: '922b2a49e348d6e613c7d276b3289a8314002c8c93257c57b327a54aefb61e20i0',
              received: false,
              sent: true,
            },
          ],
        },
        runes: {
          hasMore: false,
          items: [
            {
              runeId: '1:0',
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              sent: '3',
              received: '0',
              outgoing: '48',
              incoming: '45',
              symbol: '#',
              name: 'RUNE1:0',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription1:0',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance multiple assets receive two',
      tx: multipleAssetsReceiveTwo,
      runesInfoDictionary: new Map<string, RuneInfo>([['1:0', mapRuneToRuneInfo(getRuneInfoMock('1:0'))]]),
      expected: {
        id: '94fdcfa4fae93644d60b51bd7996c6d3d92eebf87444fe88b1d04758c2acfb6c',
        fees: 888,
        satsAmount: 1092,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1ppfwy6c4ldmv2jj9gkyayt0ejmgjcuy955qlnr2682p6fnazr2nkqrkzd7h',
              type: 'tr',
              isInput: true,
              isOutput: false,
            },
            {
              address: '39JmBRz43rS1zRjQvhqYkPWZmwKqQrgwWZ',
              type: 'sh',
              isInput: true,
              isOutput: true,
            },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 883192,
        blockTime: 1739204895,
        assetInTx: 'multipleAssets',
        txType: 'receive',
        inscriptions: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/html',
              inscribed: false,
              inscriptionId: '922b2a49e348d6e613c7d276b3289a8314002c8c93257c57b327a54aefb61e20i0',
              received: true,
              sent: false,
            },
          ],
        },
        runes: {
          hasMore: false,
          items: [
            {
              runeId: '1:0',
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              sent: '0',
              received: '48',
              outgoing: '0',
              incoming: '48',
              symbol: '#',
              name: 'RUNE1:0',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription1:0',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance multiple assets burn two',
      tx: multipleAssetsBurnTwo,
      runesInfoDictionary: new Map<string, RuneInfo>([
        ['840080:127', mapRuneToRuneInfo(getRuneInfoMock('840080:127'))],
      ]),
      expected: {
        id: '94fdcfa4fae93644d60b51bd7996c6d3d92eebf87444fe88b1d04758c2acfb6d',
        fees: 888,
        satsAmount: -1218,
        addressesInTx: null,
        blockHeight: 883193,
        blockTime: 1739204896,
        assetInTx: 'multipleAssets',
        txType: 'burn',
        inscriptions: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: true,
              contentType: 'text/plain;charset=utf-8',
              inscribed: false,
              inscriptionId: 'a1801c8f87a6751826ee902f6143fbf4a212644853428a6f5330b65650aa88a3i0',
              received: false,
              sent: true,
            },
          ],
        },
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '882500000000',
              outgoing: '888000000000',
              received: '0',
              runeId: '840080:127',
              sent: '5500000000',
              symbol: '#',
              name: 'RUNE840080:127',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840080:127',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance multiple assets send two consolidate one',
      tx: multipleAssetsSendTwoConsolidateOne,
      runesInfoDictionary: new Map<string, RuneInfo>([
        ['1:0', mapRuneToRuneInfo(getRuneInfoMock('1:0'))],
        ['840000:3', mapRuneToRuneInfo(getRuneInfoMock('840000:3'))],
      ]),
      expected: {
        id: 'b48dfbc306abd032db4bf732e3194a72c6c8cc1779d21b4cc1e2dd0df4d41793',
        fees: 2984,
        satsAmount: -290,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1pfljyeeyuddpj993expqnsngw2kjt4887we2rf3w00qj7csecxqgsqlae2l',
              type: 'tr',
              isInput: false,
              isOutput: true,
            },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 883418,
        blockTime: 1739359270,
        assetInTx: 'multipleAssets',
        txType: 'send',
        inscriptions: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: false,
              contentType: 'text/plain;charset=utf-8',
              inscribed: false,
              inscriptionId: 'a1801c8f87a6751826ee902f6143fbf4a212644853428a6f5330b65650aa88a3i0',
              received: false,
              sent: true,
            },
          ],
        },
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '285789160',
              outgoing: '385789160',
              received: '0',
              runeId: '840000:3',
              sent: '100000000',
              symbol: '#',
              name: 'RUNE840000:3',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:3',
            },
          ],
        },
      },
    },
    {
      name: 'should enhance multiple assets burn two consolidate one',
      tx: multipleAssetsBurnTwoConsolidateOne,
      runesInfoDictionary: new Map<string, RuneInfo>([
        ['1:0', mapRuneToRuneInfo(getRuneInfoMock('1:0'))],
        ['840000:3', mapRuneToRuneInfo(getRuneInfoMock('840000:3'))],
      ]),
      expected: {
        id: 'b48dfbc306abd032db4bf732e3194a72c6c8cc1779d21b4cc1e2dd0df4d41793',
        fees: 2984,
        satsAmount: -290,
        addressesInTx: null,
        blockHeight: 883418,
        blockTime: 1739359270,
        assetInTx: 'multipleAssets',
        txType: 'burn',
        inscriptions: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              burned: true,
              contentType: 'text/plain;charset=utf-8',
              inscribed: false,
              inscriptionId: 'a1801c8f87a6751826ee902f6143fbf4a212644853428a6f5330b65650aa88a3i0',
              received: false,
              sent: true,
            },
          ],
        },
        runes: {
          hasMore: false,
          items: [
            {
              address: 'bc1phrkher5h44sx4pelukf6kwahladmhzs9l96us8mcnqhxsd90cfyq9gm0l2',
              incoming: '285789160',
              outgoing: '385789160',
              received: '0',
              runeId: '840000:3',
              sent: '100000000',
              symbol: '#',
              name: 'RUNE840000:3',
              divisibility: new BigNumber(4),
              inscriptionId: 'inscription840000:3',
            },
          ],
        },
      },
    },
  ].forEach((testCase) => {
    it(testCase.name, () => {
      const result = enhanceTx({
        tx: testCase.tx,
        addresses: ownBtcAddresses,
        runesInfoDictionary: testCase.runesInfoDictionary,
      });
      expect(result).toEqual(testCase.expected);
    });
  });
});

// MARK: btc txs
describe('enhanceTx: btc txs', () => {
  [
    {
      name: 'should enhance receive btc from one address with multiple external addresses',
      tx: receiveBtcWithMultipleExternalAddresses,
      runesInfoDictionary: new Map<string, RuneInfo>([]),
      expected: {
        id: '80f115b06250a8ed3811d917fc26648f2a4592a21702d6360586cd34c939d642',
        fees: 800,
        satsAmount: 36369,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1q8pmuc2v0cku2ty0rfxp2jyvrhv6lpsjzq9y6s8',
              type: 'pkh',
              isInput: true,
              isOutput: true,
            },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 887139,
        blockTime: 1741593618,
        assetInTx: 'btc',
        txType: 'receive',
      },
    },
    {
      name: 'should enhance send btc to two addresses',
      tx: sendBtcToTwoAddresses,
      runesInfoDictionary: new Map<string, RuneInfo>([]),
      expected: {
        id: '0102dcc296785aa4ce5e966cccce486e313aac89ab8f2d05d7ea81988a90fb77',
        fees: 2025,
        satsAmount: -57025,
        addressesInTx: {
          hasMore: false,
          external: [
            {
              address: 'bc1q2n9rrd5rg0fsvuh30eqwtpm7uqyl5ww68de5mdpyvnudx93n56tsm6w44x',
              type: 'wsh',
              isInput: false,
              isOutput: true,
            },
            {
              address: 'bc1qlfedd4elqxpkd7sae45z8mltjwp0fw44sk0a20x4e7athh9yru3s6nmxm6',
              type: 'wsh',
              isInput: false,
              isOutput: true,
            },
          ],
          isOwnTaproot: false,
          isOwnNested: false,
          isOwnNative: false,
        },
        blockHeight: 886582,
        blockTime: 1741272617,
        assetInTx: 'btc',
        txType: 'send',
      },
    },
    {
      name: 'should enhance consolidate btc',
      tx: consolidateBtc,
      runesInfoDictionary: new Map<string, RuneInfo>([]),
      expected: {
        id: '79b8b804a4e7aa77153a8f1628a76b9eb2cde7d417d6382e57b43ed4a5fd8cd4',
        fees: 710,
        satsAmount: -710,
        addressesInTx: null,
        blockHeight: 887252,
        blockTime: 1741655145,
        assetInTx: 'btc',
        txType: 'consolidate',
      },
    },
  ].forEach((testCase) => {
    it(testCase.name, () => {
      const result = enhanceTx({
        tx: testCase.tx,
        addresses: ownBtcAddresses,
        runesInfoDictionary: testCase.runesInfoDictionary,
      });
      expect(result).toEqual(testCase.expected);
    });
  });
});
